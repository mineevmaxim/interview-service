Что у нас есть на данный момент:
1. Докер образ в Container Registry
2. Кластер kubernetes
3. База данных PostgeSQL в кластере
4. База данных MongoDB в кластере
5. В кластере kubernetes работает приложение (пока работает только бэк, фронт пытается подниматься, но выдает ошибку на npm. Пытались исправить пару часов, ничего не получилось![[Pasted image 20250517163802.png]]. До бэка можно достучаться при помощи сваггера `<ip-балансировщика>/swagger`)
6. Балансировщик нагрузки для приложения с автоматическим мастабированием 1-3 вм (не проверяли масштабирование, но сам балансировщик работает, требование соблюдено)
7. Описаны: Dockerfile, coderev.yaml (манифест для k8s для поднятия приложения), load-balancer.yaml (манифет для k8s для поднятия балансировщика нагрузки)
8. Добавлен эндпоинт удаления задач (заглушка) → требование «Полный набор CRUD» удовлетворено
9. Теперь в «Development» и «Production» моде приложение работает одинаково (в обоих случаях поднимается сваггер, пытается подниматься фронт)
10. Есть сервисный аккаунт специально для кубера с настроенными правами
11. В принципе текущую систему уже можно пробовать описать в terraform  

P.S. Т.к. фронт не получается поднять, возникла идея просто его игнорить, оставить только бэк. В принципе, никаким требованиям это не противоречит, так что мы можем так сделать.

Выполненные требования на данный момент:
- [x] Реализовывать полный набор CRUD-операций над какими либо данными (Create, Read, Update, Delete).
- [x] Будет построен на базе любого фреймворка и языка программирования (Пример: PHP -> YII, Laravel, Python -> Django, Flask, Java -> SpringBoot, JS -> Angular, React, NextJS, NuxtJS, SvelteKi и т.д.).
- [x] База данных (MySQL, PoostgreSQL, MongoDB и т. д.) должна использоваться в виде кластера.
- [ ] Для размещения статических файлов приложение в своей работе должно использовать Object Storage Yandex Cloud.
- [x] В решении должен быть использован балансировщик нагрузки Yandex.Cloud
- [ ] Разворачивание всей информационной системы должно быть описано общей Terraform-спецификацией.
- [x] В решении должна быть затронута настройка Виртуальных сетей Yandex Cloud.
- [x] Также в информационной системе должны быть использованы какие-либо Serverless-решения (Docker-контейнеры, Cloud Functions, Serverless YDB, Yandex Message Queue)
- [ ] Должен быть настроен мониторинг системы с использованием Yandex Monitoring и т.п.
- [x] Должна быть описана ролевая модель доступа к ресурсам и настроен сервис Identity and Access Management.
- [ ] Расчёт стоимости эксплуатации системы при минимальной, средней и максимальной нагрузке. Рекомендации по экономии ресурсов (например описать настройку балансировщиков).

Осталось сделать: 
- [ ] Описать terraform-спецификацию
- [ ] Расчёт стоимости эксплуатации системы при минимальной, средней и максимальной нагрузке. Рекомендации по экономии ресурсов (например описать настройку балансировщиков)
- [ ] Для размещения статических файлов приложение в своей работе должно использовать Object Storage Yandex Cloud. (**Если выпилим фронт, то особо нет смысла, так как все статичные файлы именно в нем. Но можем сделать для галочки, условный план: создать бакет, закинуть в него все необходимые иконки, поменять все пути к иконкам на фронте на публичные ссылки на эти иконки в бакете (атрибут href тега `<img href="путь"/>`)**)
- [ ] Настроить мониторинг — просто включить везде логи + возможно, добавить какой-то дашборд

P.S. На данный момент всё создано, но остановлено, для возобновления работы нужно поднять:
1. Кластер БД PostgreSQL
2. Кластер БД MongoDB
3. Балансировщик нагрузки Network Load Balancer
4. Кластер kubernetes Managed Service for Kubernetes

Актуальная версия приложения со всеми конфигурационными файлами находится в репозитории: <https://github.com/mineevmaxim/interview-service>

# Полезные инструкции

Должен быть настроен `kubectl` (есть в практиках по куберу)

Создать кластер в kubernetes manages service (если не создан)

Подключиться (в консоли управления на странице кластера сверху кнопка «Подключиться?»)
```bash
 yc managed-kubernetes cluster get-credentials \
   --id <идентификатор_кластера> \
   --external
```

Манифесты (спецификации) для кубера лежат в репозитории в папке `ci`

Поднять приложение:
```bash
kubectl apply -f ci/coderev.yaml
```

Поднять балансировщик:
```bash
kubectl apply -f ci/load-balancer.yaml
```

При изменении `Dockerfile` (нужно находиться в папке с `Dockerfile`):  
Настраиваем docker:
```bash
yc container registry configure-docker
```
Билдим и пушим в реестр Container Registry:
```bash
docker build . -t cr.yandex/crp8okhcn80ouakb2is1/project:latest
docker push cr.yandex/crp8okhcn80ouakb2is1/project:latest
```

Сервисный аккаунт для кубера:
```
mineevmaxim-k8s-resources-load-balancer — с правами на создание балансировщика (предпочтительно)

mineevmaxim-k8s-resources — без прав на создание балансировщика
```
